{# page--events.html.twig #}
<div class="ibew-page bg-gray-100 text-gray-900 min-h-screen">

	{% include '@ibew_theme/includes/header.html.twig' %}

	{# --- EVENTS CONTENT --- #}
	<section class="relative py-20 overflow-hidden">
		<div class="absolute inset-0 bg-ibew-navy opacity-90 z-0"></div>
		<div class="absolute inset-0 z-0" style="background-image: url('/themes/custom/ibew_theme/screenshot.jpg'); background-size: cover; mix-blend-mode: overlay; opacity: 0.2;"></div>
		<div class="container relative z-10 text-center text-white">
			<h1 class="font-oswald text-5xl md:text-6xl fw-bold text-uppercase mb-2 tracking-wide">Events Calendar</h1>
			<p class="text-gray-300 text-lg">Stay connected with union meetings, training, and community events</p>
		</div>
	</section>

	<section class="py-8 bg-ibew-navy border-bottom border-gray-800">
		<div class="container">
			<div class="flex flex-col md:flex-row justify-between items-center gap-4">
				<div class="flex gap-2">
					<button class="btn btn-primary px-4 py-2 fw-bold active" data-filter="all">All Events</button>
					<button class="btn btn-outline-secondary text-white border-gray-600 px-4 py-2 fw-bold hover:bg-gray-700" data-filter="meeting">Meetings</button>
					<button class="btn btn-outline-secondary text-white border-gray-600 px-4 py-2 fw-bold hover:bg-gray-700" data-filter="training">Training</button>
				</div>
				<div class="flex gap-3 items-center w-full md:w-auto">
					<div class="relative flex-grow md:flex-grow-0">
						<input type="text" placeholder="Search events..." class="form-control bg-gray-800 border-gray-700 text-white rounded px-3 py-2 w-full md:w-64 focus:ring-ibew-gold ring-offset-0">
					</div>
					<div class="btn-group" role="group">
						<button id="viewListBtn" class="btn btn-danger text-white px-3 py-2 active">List</button>
						<button id="viewCalendarBtn" class="btn btn-secondary bg-gray-700 text-white border-gray-600 px-3 py-2">Calendar</button>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="py-12 bg-ibew-navy-light relative w-100 h-100">
		<div class="container">
			<div id="eventsListView" class="transition-opacity duration-300">
				{% if embedded_events_view %}
					{{ embedded_events_view }}
				{% else %}
					<p class="text-white">No events view found. Please ensure 'homepage_events' view is active.</p>
				{% endif %}
			</div>
			<div id="eventsCalendarView" class="hidden bg-white rounded-lg p-4 shadow-xl text-dark">
				<div id="calendar"></div>
			</div>
		</div>
	</section>

	{# --- Redesigned Footer --- #}
	<footer class="ibew-footer">
		<div class="ibew-shell max-w-7xl mx-auto px-6">

			<div
				class="ibew-footer__container">
				<!-- Col 1: Brand -->
				<div class="ibew-footer__brand-col">
					{% if page.footer_col_1 %}
						{{ page.footer_col_1 }}
					{% else %}
						<a href="/" class="ibew-footer__brand-logo">
							<img src="/themes/custom/ibew_theme/logo.png" alt="Local 90">
							<span>Local 90</span>
						</a>
						<p>Serving our community with excellence in electrical work since 1892. Building tomorrow's infrastructure today.</p>
					{% endif %}
				</div>

				<!-- Col 2: Quick Links -->
				<div>
					{% if page.footer_col_2 %}
						{{ page.footer_col_2 }}
					{% else %}
						<h4>Quick Links</h4>
						<ul class="ibew-footer__links">
							<li>
								<a href="/about">About Us</a>
							</li>
							<li>
								<a href="/training">Training Programs</a>
							</li>
							<li>
								<a href="/join">Become a Member</a>
							</li>
							<li>
								<a href="/contractors">Find a Contractor</a>
							</li>
						</ul>
					{% endif %}
				</div>

				<!-- Col 3: Members -->
				<div>
					{% if page.footer_col_3 %}
						{{ page.footer_col_3 }}
					{% else %}
						<h4>Members</h4>
						<ul class="ibew-footer__links">
							<li>
								<a href="/member-portal" class="highlight">Member Portal</a>
							</li>
							<li>
								<a href="/dues">Pay Dues</a>
							</li>
							<li>
								<a href="/benefits">Benefits Info</a>
							</li>
							<li>
								<a href="/jobs">Job Board</a>
							</li>
						</ul>
					{% endif %}
				</div>

				<!-- Col 4: Contact -->
				<div>
					{% if page.footer_col_4 %}
						{{ page.footer_col_4 }}
					{% else %}
						<h4>Contact</h4>
						<div class="ibew-footer__contact-item">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewbox="0 0 16 16"><path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/></svg>
							<span>(203) 265-9533</span>
						</div>
						<div class="ibew-footer__contact-item">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewbox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/></svg>
							<a href="mailto:info@ibewlocal90.org" class="text-gray-400 hover:text-white">info@ibewlocal90.org</a>
						</div>
						<div class="ibew-footer__contact-item">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewbox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>
							<span>2 N Plains Industrial Rd<br>Wallingford, CT 06492</span>
						</div>
					{% endif %}
				</div>

			</div>

			<div class="ibew-footer__bottom">
				{% if page.footer %}
					{{ page.footer }}
				{% else %}
					&copy;
					{{ "now"|date("Y") }}
					IBEW Local 90. All rights reserved.
				{% endif %}
			</div>
		</div>
	</footer>

</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
var calendarEl = document.getElementById('calendar');
var calendar = new FullCalendar.Calendar(calendarEl, {
initialView: 'dayGridMonth',
headerToolbar: {
left: 'prev,next today',
center: 'title',
right: 'dayGridMonth,timeGridWeek,listWeek'
},
themeSystem: 'bootstrap5',
height: 'auto',
events: function (info, successCallback, failureCallback) { // Fetch events from Drupal
fetch('/events-json').then(response => response.json()).then(data => {
const events = data.map(event => ({
title: event.title,
start: event.start,
end: event.end,
url: event.url,
backgroundColor: event.type === 'training' ? '#983A54' : '#313F6B',
borderColor: event.type === 'training' ? '#983A54' : '#313F6B'
}));
successCallback(events);
}).catch(error => {
console.error('Error loading events:', error);
// Fallback to sample events
successCallback([
{
title: 'Monthly Union Meeting',
start: '2026-03-18T18:00:00',
backgroundColor: '#313F6B'
}, {
title: 'OSHA Safety Workshop',
start: '2026-03-22T09:00:00',
backgroundColor: '#983A54'
}, {
title: 'Regional Job Fair',
start: '2026-03-25T10:00:00',
backgroundColor: '#313F6B'
}
]);
});
},
eventClick: function (info) {
if (info.event.url) {
window.location.href = info.event.url;
info.jsEvent.preventDefault();
}
}
});

const listBtn = document.getElementById('viewListBtn');
const calBtn = document.getElementById('viewCalendarBtn');
const listView = document.getElementById('eventsListView');
const calView = document.getElementById('eventsCalendarView');

listBtn.addEventListener('click', function () {
listView.classList.remove('hidden');
calView.classList.add('hidden');
listBtn.classList.add('btn-danger');
listBtn.classList.remove('btn-secondary', 'bg-gray-700');
calBtn.classList.remove('btn-danger');
calBtn.classList.add('btn-secondary', 'bg-gray-700');
});

calBtn.addEventListener('click', function () {
listView.classList.add('hidden');
calView.classList.remove('hidden');
calBtn.classList.add('btn-danger');
calBtn.classList.remove('btn-secondary', 'bg-gray-700');
listBtn.classList.remove('btn-danger');
listBtn.classList.add('btn-secondary', 'bg-gray-700');
setTimeout(() => calendar.render(), 100);
});

// Filter functionality
const filterButtons = document.querySelectorAll('[data-filter]');
filterButtons.forEach(btn => {
btn.addEventListener('click', function () {
const filter = this.getAttribute('data-filter');
filterButtons.forEach(b => b.classList.remove('active', 'btn-primary'));
filterButtons.forEach(b => b.classList.add('btn-outline-secondary', 'text-white', 'border-gray-600'));
this.classList.add('active', 'btn-primary');
this.classList.remove('btn-outline-secondary', 'text-white', 'border-gray-600');

// Filter events in list view
const eventCards = document.querySelectorAll('.ibew-event-card');
eventCards.forEach(card => {
if (filter === 'all') {
card.closest('.views-row') ?. classList.remove('hidden');
} else {
const cardText = card.textContent.toLowerCase();
const shouldShow = (filter === 'training' && cardText.includes('training')) || (filter === 'meeting' && cardText.includes('meeting'));
card.closest('.views-row') ?. classList.toggle('hidden', ! shouldShow);
}
});
});
});
});
</script>
