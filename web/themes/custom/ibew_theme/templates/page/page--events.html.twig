{# page--events.html.twig #}
<div class="ibew-page bg-gray-100 text-gray-900 min-h-screen">

	{% include '@ibew_theme/includes/header.html.twig' %}

	{# --- EVENTS CONTENT --- #}
	<section class="relative py-20 overflow-hidden">
		<div class="absolute inset-0 bg-ibew-navy opacity-90 z-0"></div>
		<div class="absolute inset-0 z-0" style="background-image: url('/themes/custom/ibew_theme/screenshot.jpg'); background-attachment: fixed; background-position: center; background-repeat: no-repeat; background-size: cover; mix-blend-mode: overlay; opacity: 0.2;"></div>
		<div class="container relative z-10 text-center text-white">
			<h1 class="font-oswald text-5xl md:text-6xl fw-bold text-uppercase mb-2 tracking-wide">Events Calendar</h1>
			<p class="text-gray-300 text-lg">Stay connected with union meetings, training, and community events</p>
		</div>
	</section>

	<section class="py-8 bg-ibew-navy border-bottom border-gray-800">
		<div class="container">
			<div class="flex flex-col md:flex-row justify-between items-center gap-4">
				<div class="flex gap-2">
					<button class="btn btn-primary px-4 py-2 fw-bold active" data-filter="all">All Events</button>
					<button class="btn btn-outline-secondary text-white border-gray-600 px-4 py-2 fw-bold hover:bg-gray-700" data-filter="meeting">Meetings</button>
					<button class="btn btn-outline-secondary text-white border-gray-600 px-4 py-2 fw-bold hover:bg-gray-700" data-filter="training">Training</button>
				</div>
				<div class="flex gap-3 items-center w-full md:w-auto">
					<div class="relative flex-grow md:flex-grow-0">
						<input type="text" placeholder="Search events..." class="form-control bg-gray-800 border-gray-700 text-white rounded px-3 py-2 w-full md:w-64 focus:ring-ibew-gold ring-offset-0">
					</div>
					<div class="btn-group" role="group">
						<button id="viewListBtn" class="btn btn-danger text-white px-3 py-2 active">List</button>
						<button id="viewCalendarBtn" class="btn btn-secondary bg-gray-700 text-white border-gray-600 px-3 py-2">Calendar</button>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="py-12 bg-ibew-navy-light relative w-100 h-100">
		<div class="container">
			<div id="eventsListView" class="transition-opacity duration-300">
				{% if embedded_events_view %}
					{{ embedded_events_view }}
				{% else %}
					<p class="text-white">No events view found. Please ensure 'homepage_events' view is active.</p>
				{% endif %}
			</div>
			<div id="eventsCalendarView" class="hidden bg-white rounded-lg p-4 shadow-xl text-dark">
				<div id="calendar"></div>
			</div>
		</div>
	</section>

	{# --- Footer (Reusable Include) --- #}
	{% include '@ibew_theme/includes/footer.html.twig' %}

</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
var calendarEl = document.getElementById('calendar');
var calendar = new FullCalendar.Calendar(calendarEl, {
initialView: 'dayGridMonth',
headerToolbar: {
left: 'prev,next today',
center: 'title',
right: 'dayGridMonth,timeGridWeek,listWeek'
},
themeSystem: 'bootstrap5',
height: 'auto',
events: function (info, successCallback, failureCallback) { // Fetch events from Drupal
fetch('/events-json').then(response => response.json()).then(data => {
const events = data.map(event => ({
title: event.title,
start: event.start,
end: event.end,
url: event.url,
backgroundColor: event.type === 'training' ? '#983A54' : '#313F6B',
borderColor: event.type === 'training' ? '#983A54' : '#313F6B'
}));
successCallback(events);
}).catch(error => {
console.error('Error loading events:', error);
// Fallback to sample events
successCallback([
{
title: 'Monthly Union Meeting',
start: '2026-03-18T18:00:00',
backgroundColor: '#313F6B'
}, {
title: 'OSHA Safety Workshop',
start: '2026-03-22T09:00:00',
backgroundColor: '#983A54'
}, {
title: 'Regional Job Fair',
start: '2026-03-25T10:00:00',
backgroundColor: '#313F6B'
}
]);
});
},
eventClick: function (info) {
if (info.event.url) {
window.location.href = info.event.url;
info.jsEvent.preventDefault();
}
}
});

const listBtn = document.getElementById('viewListBtn');
const calBtn = document.getElementById('viewCalendarBtn');
const listView = document.getElementById('eventsListView');
const calView = document.getElementById('eventsCalendarView');

listBtn.addEventListener('click', function () {
listView.classList.remove('hidden');
calView.classList.add('hidden');
listBtn.classList.add('btn-danger');
listBtn.classList.remove('btn-secondary', 'bg-gray-700');
calBtn.classList.remove('btn-danger');
calBtn.classList.add('btn-secondary', 'bg-gray-700');
});

calBtn.addEventListener('click', function () {
listView.classList.add('hidden');
calView.classList.remove('hidden');
calBtn.classList.add('btn-danger');
calBtn.classList.remove('btn-secondary', 'bg-gray-700');
listBtn.classList.remove('btn-danger');
listBtn.classList.add('btn-secondary', 'bg-gray-700');
setTimeout(() => calendar.render(), 100);
});

// Filter functionality
const filterButtons = document.querySelectorAll('[data-filter]');
filterButtons.forEach(btn => {
btn.addEventListener('click', function () {
const filter = this.getAttribute('data-filter');
filterButtons.forEach(b => b.classList.remove('active', 'btn-primary'));
filterButtons.forEach(b => b.classList.add('btn-outline-secondary', 'text-white', 'border-gray-600'));
this.classList.add('active', 'btn-primary');
this.classList.remove('btn-outline-secondary', 'text-white', 'border-gray-600');

// Filter events in list view
const eventCards = document.querySelectorAll('.ibew-event-card');
eventCards.forEach(card => {
if (filter === 'all') {
card.closest('.views-row') ?. classList.remove('hidden');
} else {
const cardText = card.textContent.toLowerCase();
const shouldShow = (filter === 'training' && cardText.includes('training')) || (filter === 'meeting' && cardText.includes('meeting'));
card.closest('.views-row') ?. classList.toggle('hidden', ! shouldShow);
}
});
});
});
});
</script>
